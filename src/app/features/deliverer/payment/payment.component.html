<div class="payment-page">
  <button class="btn-back" (click)="goBack()">← Voltar</button>

  <div *ngIf="loading" class="loading">
    <p>Carregando informações...</p>
  </div>

  <div *ngIf="error && !loading" class="error">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="delivery && !loading" class="payment-content">
    <header class="payment-header">
      <h1>Registrar Pagamento</h1>
      <p class="customer-name">{{ delivery.customer_name }}</p>
    </header>

    <div class="payment-summary">
      <div class="summary-item">
        <span class="label">Valor Total:</span>
        <span class="value">{{ delivery.total_amount | currency:delivery.currency:'symbol':'1.2-2' }}</span>
      </div>
      <div class="summary-item">
        <span class="label">Valor Informado:</span>
        <span class="value">{{ getAmountInReais() | currency:delivery.currency:'symbol':'1.2-2' }}</span>
      </div>
      <div class="summary-item" *ngIf="getPendingAmount() > 0">
        <span class="label">Pendente:</span>
        <span class="value pending">{{ getPendingAmount() | currency:delivery.currency:'symbol':'1.2-2' }}</span>
      </div>
      <div class="summary-item" *ngIf="getPendingAmount() < 0">
        <span class="label">Troco:</span>
        <span class="value change">{{ -getPendingAmount() | currency:delivery.currency:'symbol':'1.2-2' }}</span>
      </div>
    </div>

    <form (ngSubmit)="submitPayment()" class="payment-form">
      <div class="form-group">
        <label for="payment-method">Forma de Pagamento *</label>
        <select id="payment-method" [(ngModel)]="paymentMethod" name="paymentMethod" required>
          <option value="cash">Dinheiro</option>
          <option value="pix">PIX</option>
          <option value="pending">Pendente</option>
        </select>
      </div>

      <div class="form-group">
        <label for="amount">Valor Recebido ({{ delivery.currency }}) *</label>
        <input 
          type="number" 
          id="amount" 
          [(ngModel)]="amountCents" 
          name="amount"
          [value]="getAmountInReais()"
          (input)="setAmountInReais($any($event.target).value)"
          step="0.01"
          min="0"
          required>
        <small>Digite o valor em {{ delivery.currency }}</small>
      </div>

      <div class="form-group" *ngIf="paymentMethod === 'pix'">
        <label for="external-reference">Código da Transação PIX (opcional)</label>
        <input 
          type="text" 
          id="external-reference" 
          [(ngModel)]="externalReference" 
          name="externalReference"
          placeholder="Ex: E12345678920240101120000">
      </div>

      <div class="form-group">
        <label for="payment-notes">Observações (opcional)</label>
        <textarea 
          id="payment-notes" 
          [(ngModel)]="paymentNotes" 
          name="paymentNotes"
          rows="3"
          placeholder="Observações sobre o pagamento..."></textarea>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="goBack()" [disabled]="submitting">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="submitting">
          <span *ngIf="!submitting">Registrar Pagamento</span>
          <span *ngIf="submitting">Registrando...</span>
        </button>
      </div>
    </form>
  </div>
</div>
